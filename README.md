# Docstring-AI ü§ñ‚ú®

![License](https://img.shields.io/github/license/ph-ausseil/docstring-ai)
![Python Version](https://img.shields.io/badge/python-3.7%2B-blue.svg)

> **Automate and Enhance Your Python Documentation with AI-Powered Precision**

---

## üìú What is Docstring-AI?

Docstring-AI is an advanced tool that **generate high-quality Python docstrings** for your codebase. It has has been created to facilitate LLM training over a Project Codebase. 

### üåü Key Features

- **Docstring Generation**: Leverages LLM to generate comprehensive and context-aware docstrings.
- **Detection of Git Repository**: Detects if a folder is a Git repository and create PR (Example : **[#8](https://github.com/ph-ausseil/docstring-ai/pull/8)**)
- **Optioonal Manual Validation**: using `--manual` argument will show a `diff`
- **Optimized**: Cache (Reduce API calls), optimized processing order, gather context over time (Partly implemented : [#4](https://github.com/ph-ausseil/docstring-ai/issues/4)**),

### üåü Example : 

> [!TIP]
> Doctstring-AI's docstrings are generated by Docstring-AI : [#8](https://github.com/ph-ausseil/docstring-ai/pull/8)
> 
| ![image width=300](https://github.com/user-attachments/assets/0742a2a1-7eb5-4d91-909d-f44f0d441c16) | ![image width=300](https://github.com/user-attachments/assets/95865581-6f46-4d99-a393-b33b5a9185c5) | ![image width=300](https://github.com/user-attachments/assets/6fa03c94-1051-498c-ae9b-4432c8818226) |
|-------------------------|-------------------------|-------------------------|
| PR Generated with list of file changed | Module level Docstring | Always review PR as typing have been (correctly)  changed without human supervision . Note : This is related to the current prompt. A `--strict` option will be provided later. |

---

## üìö Table of Contents

1. [üìú What is Docstring-AI?](#-what-is-docstring-ai)
2. [üåü Key Features](#-key-features)
3. [üöÄ Getting Started](#-getting-started)
4. [üèÉ‚Äç‚ôÇÔ∏è Running Docstring-AI](#Ô∏è-running-docstring-ai)
   - [Basic Usage](#basic-usage)
   - [With GitHub Pull Request Creation](#with-github-pull-request-creation)
   - [Enabling Manual Validation](#enabling-manual-validation)
5. [üìù Understanding Flags](#-understanding-flags)
6. [üîç Detailed Explanation of `--pr-depth`](#-detailed-explanation-of---pr-depth)
7. [üîç Manual Validation Workflow](#-manual-validation-workflow)
8. [üõ§Ô∏è Roadmap](#Ô∏è-roadmap)
9. [üìö Additional Information](#-additional-information)
10. [‚òï Support the Project](#-support-the-project)
11. [ü§ù Contributing](#-contributing)
12. [üìÑ License](#-license)
13. [üßë‚Äçüíª Contact](#-contact)
---

## üöÄ Getting Started

1. **Clone the Repository**
```bash
git clone https://github.com/yourusername/docstring-ai.git
cd docstring-ai
```

2. **Install Poetry**
```bash
pip install poetry
```

3. **Configure Environment Variables**
    - Copy the template and add your OpenAI API key:
```bash
cp .env.template .env
```
    - Open the `.env` file and set your `OPENAI_API_KEY`. If you plan to use GitHub PR features, also set `GITHUB_TOKEN` and `GITHUB_REPO` as needed.

4. **Install Project Dependencies**
```bash
poetry install
```

---

## üèÉ‚Äç‚ôÇÔ∏è Running Docstring-AI

### üèÉ‚Äç‚ôÇÔ∏è Basic Usage

Run Docstring-AI to automatically generate docstrings for your Python repository:

```bash
poetry run . --path=/path/to/repo
```

> [!TIP]
> To skip users confirmartions use the `--use-repo-config` flag for seamless Git integration. It automatically detects the repository local configuration.

```bash
poetry run . --path=/path/to/repo --use-repo-config
```

---

### üõ†Ô∏è Enabling Manual Validation

Enable manual review of changes to ensure they align with your requirements:

```bash
poetry run . --path=/path/to/repo --manual 
```

---

## üìù Understanding Flags

### General Flags

| Flag             | Description                                                                                                          |
|------------------|----------------------------------------------------------------------------------------------------------------------|
| `--path`         | **(Required)** Path to the repository or folder containing Python files.                                            |
| `--api_key`      | OpenAI API key. Defaults to the `OPENAI_API_KEY` environment variable if not provided.                              |
| `--manual`       | Enable manual validation with diff preview before committing changes or creating PRs.                               |
| `--help-flags`   | List and describe all available flags.                                                                               |

---

### GitHub Integration Flags

| Flag             | Description                                                                                                          |
|------------------|----------------------------------------------------------------------------------------------------------------------|
| `--pr`           | GitHub repository for PR creation in the format `owner/repository`. Overrides the `GITHUB_REPO` environment variable if provided. |
| `--target-branch`| Repository branch that is the target of the created PR (Default: Suggest the current branch).                        |
| `--github-token` | GitHub personal access token. Defaults to the `GITHUB_TOKEN` environment variable if not provided.                  |
| `--branch-name`  | Branch name for the PR. Auto-generated if not provided.                                                             |
| `--pr-name`      | Custom name for the pull request. Defaults to `-- Add docstrings for files in 'path'.`                              |
| `--pr-depth`     | Depth level for creating PRs per folder. Defaults to `2`.                                                           |

---

### Advanced Flags

| Flag             | Description                                                                                                          |
|------------------|----------------------------------------------------------------------------------------------------------------------|
| `--use-repo-config` | Use the repository‚Äôs Git configuration for GitHub integration. Overrides other GitHub-related parameters.         |
| `--no-cache`     | Execute the script without cached values by deleting cache files.                                                   |


---

## üîç Detailed Explanation of Git Flags

---

### Priority Policies

| Configuration Method       | Priority     | Description                                                                                      |
|----------------------------|--------------|--------------------------------------------------------------------------------------------------|
| `--use-repo-config`        | **Highest**  | Detects repository and branch automatically, overriding all other settings.                     |
| Explicit Flags (`--pr`, etc.) | Medium       | Manually specifies repository and GitHub token, overriding environment variables.               |
| Environment Variables      | Lowest       | Reads `GITHUB_REPO` and `GITHUB_TOKEN` from `.env` or system environment.                       |
<!-- | Fallback                   | Lowest      | Skips GitHub integration entirely, modifying files locally.                                     |-->

### Priority Process

> [!NOTE]
> By default, the application tries to detect the local repository and suggest. User confirmation will be requested.

| Configuration     | Priority (Highest to Lowest)                                                | Default Behavior                          |
|-------------------|----------------------------------------------------------------------------|-------------------------------------------|
| Repository (`--pr`) | 1. `--use-repo-config` ‚Üí 2. Detect Local Config ‚Üí 3. `--pr` ‚Üí 4. `GITHUB_REPO` | Detects local repository and suggests it. |
| Token (`--github-token`) | 1. `--github-token` ‚Üí 2. `GITHUB_TOKEN`                               | None. Must be explicitly provided.        |
| Target Branch (`--target-branch`) | 1. `--target-branch` ‚Üí 2. `GITHUB_TARGET_BRANCH`              | Defaults to the current branch.           |
| Branch Name (`--branch-name`) | 1. Auto-generated ‚Üí  `--branch-name`                                              | Auto-generated.                           |


---
<details>
<summary>Details : GitHub Repository (`--pr`)</summary>

> [!TIP]
> `--use-repo-config` skips the confirmations process.

1. **`--use-repo-config` (Highest Priority)**:  
   - Automatically detects the repository from the local Git configuration and uses it.  
   - Overrides all other configurations, including `--pr` and `GITHUB_REPO`.  


2. **Local Repository Detection**:  
   - If `--use-repo-config` is not enabled, the tool attempts to detect if the provided path is part of a local Git repository.  
   - The detected repository is suggested for confirmation before proceeding.  

3. **`--pr` Flag**:  
   - Manually specify the repository using the `--pr` flag.  
   - Overrides the `GITHUB_REPO` environment variable if provided.

4. **Environment Variable (`GITHUB_REPO`)**:  
   - Used as a fallback if no other configuration is specified.
</details>

---

<details>
<summary>Details : GitHub Token (`--github-token`)</summary>

1. **Command-Line Flag**:  
   - Highest priority when provided via the `--github-token` flag.  
   - Overrides the `GITHUB_TOKEN` environment variable.  

2. **Environment Variable (`GITHUB_TOKEN`)**:  
   - Used as a fallback if no explicit token is provided.

> [!WARNING]
> Ensure a GitHub token is provided via `--github-token` or `GITHUB_TOKEN` when using GitHub integration to avoid authentication issues.
</details>

---

<details>
<summary>Details : Target Branch (`--target-branch`)</summary>

1. **Default Behavior**:  
   - Defaults to the current branch detected from the local Git repository.  

2. **Overrides**:  
   - Can be explicitly set using the `--target-branch` flag or via the `GITHUB_TARGET_BRANCH` environment variable.

> [!TIP]
> Default branch detection ensures that pull requests target the branch you're actively working on, reducing manual configuration.
</details>

---

<details>
<summary>Details : Branch Name (`--branch-name`)</summary>


1. **Default Behavior**:  
   - Automatically generated if not specified.  
     Example: `feature/docstring-updates-YYYYMMDDHHMMSS`.  

2. **Overrides**:  
   - Can be manually specified using the `--branch-name` flag to ensure consistency or adhere to naming conventions.
</details>

---

### üîç Explanation of `--pr-depth`

The `--pr-depth` argument controls how changes are grouped into pull requests based on folder structure. It allows for flexibility in organizing PRs, especially for large repositories.

### How it Works:

- **Depth `0`**: Each Python file will have its own pull request. This is ideal for repositories with minimal interdependencies between files.
- **Depth `1`**: All Python files within the same immediate folder (and its subfolders) will be grouped into a single PR.
- **Depth `2` (Default)**: Python files are grouped by their second-level folder hierarchy. For example:
```
/repo
‚îú‚îÄ‚îÄ folderA/
‚îÇ   ‚îú‚îÄ‚îÄ subfolderA1/
‚îÇ   ‚îú‚îÄ‚îÄ subfolderA2/
‚îú‚îÄ‚îÄ folderB/
    ‚îú‚îÄ‚îÄ subfolderB1/
```
  - Files in `folderA` and its subfolders are grouped into one PR.
  - Files in `folderB` and its subfolders are grouped into another PR.

### Use Cases:

1. **Small Repositories**: Use `--pr-depth=0` for fine-grained PRs that isolate changes per file.
2. **Medium Repositories**: Use `--pr-depth=1` to consolidate related changes within folders.
3. **Large Repositories**: Use the default `--pr-depth=2` to group changes at higher levels, reducing the number of PRs.

---

## üîç Manual Validation Workflow

When the `--manual` flag is enabled, Docstring-AI introduces an interactive review process to ensure that all changes are intentional and meet your quality standards.

### Steps:

1. **Diff Preview**:
    - After generating modified code with added docstrings, Docstring-AI displays a unified diff between the original and modified files.
    - Example:
```diff
--- original
+++ modified
@@ -1,3 +1,5 @@
 def example_function(param1, param2):
+    """
+    Adds two parameters.
+
     # Function implementation
```

2. **User Confirmation**:
    - You are prompted to approve or reject the changes for each file.
    - Respond with `yes` to apply the changes or `no` to skip them.

3. **Applying Changes**:
    - Approved changes are either directly applied to the files or prepared for PR creation, depending on your setup.

4. **PR Confirmation** (if Git is present):
    - Before creating pull requests, you are prompted to confirm the creation of PRs for the categorized folders.

---

## üõ§Ô∏è Roadmap

### 1. **Core Functionality**
   - **Description**: Establish the foundational features that enable Docstring-AI to traverse Python repositories, generate docstrings using OpenAI's Assistants API, manage context with ChromaDB, and implement a SHA-256 caching mechanism to optimize performance.
   - **Current Status**: Completed.

### 2. **PyPI Module**
   - **Description**: Distribute Docstring-AI as a **PyPI package**, allowing developers to install and use it effortlessly within their projects. This makes it accessible for both local and global installations, facilitating seamless integration into various development environments.

### 3. **GitHub Action Package**
   - **Description**: Package Docstring-AI as a **GitHub Action** to automate docstring generation within your CI/CD pipeline. This integration ensures that every commit or pull request is automatically documented, maintaining consistent and up-to-date documentation across the repository.

### 4. **Granularity**
   - **Description**: Leveraging Structured Outputs , choose which docstring to generate : Modules, Classes, Functions & Constants levels

### 5. **Console improvements** : 
   - **Description**: Use of the tdmq wrapper & enhance the logging class

---

## üìö Additional Information

### üîß Configuration

- **Environment Variables**:
  - `OPENAI_API_KEY`: Your OpenAI API key.
  - `GITHUB_TOKEN`: Your GitHub personal access token.
  - `GITHUB_REPO`: GitHub repository in the format `owner/repository`.

### ü§ù Contributing

Contributions are welcome! Please open an issue or submit a pull request for any enhancements or bug fixes.

### üìÑ License

This project is licensed under the [MIT License](https://github.com/ph-ausseil/docstring-ai/blob/main/LICENSE).

---

## üßë‚Äçüíª Author & Contact

I'm not a developper, just doing this on my spare time. Not dropping my email, but you can reach out on LinkedIn


## ‚òï Support the Project


If you found this project useful and want to show your support, you can contribute to my OpenAI API consumption & buy me a coffee :

[![Buy Me a Coffee](https://img.shields.io/badge/Buy%20Me%20a%20Coffee-Support-orange)](https://www.buymeacoffee.com/phausseil) & **Bitcoin Address**: 3Dj9HfwzmduDuZrT6ieHQzkM6M8oDBhW6t

---

Thank you for your generosity and for supporting open-source software! ‚ù§Ô∏è
